# API Specification

## PostgREST REST API

PostgREST auto-generates REST endpoints from the PostgreSQL schema. All endpoints follow a consistent pattern.

**Base URL**: `http://postgrest.railway.internal:3000` (internal) or `https://api.example.com` (public via proxy)

## Common Patterns

### List Resources

```http
GET /jobs?is_archived=eq.false&order=scraped_at.desc&limit=20
```

**Query Parameters**:
- `select`: Specify columns (`select=id,title,company`)
- `order`: Sort order (`order=created_at.desc`)
- `limit`: Limit results (`limit=20`)
- `offset`: Pagination (`offset=20`)
- Filters: `column=operator.value` (e.g., `match_score=gte.80`)

**Operators**:
- `eq`: Equals
- `neq`: Not equals
- `gt`: Greater than
- `gte`: Greater than or equal
- `lt`: Less than
- `lte`: Less than or equal
- `like`: Pattern match
- `ilike`: Case-insensitive pattern match
- `in`: In list (`tags=in.(typescript,react)`)
- `overlaps`: Array overlap (`tags=overlaps.{typescript,react}`)

### Get Single Resource

```http
GET /jobs?id=eq.abc-123
```

Returns array with single item or empty array if not found.

### Embedded Resources

```http
GET /applications?select=*,job:jobs(*),project:application_projects(*)
```

Returns applications with embedded job and project data.

### Create Resource

```http
POST /applications
Content-Type: application/json
Authorization: Bearer <JWT>

{
  "job_id": "abc-123",
  "project_id": "proj-456",
  "status": "draft"
}
```

### Update Resource

```http
PATCH /applications?id=eq.app-789
Content-Type: application/json
Authorization: Bearer <JWT>

{
  "status": "applied",
  "applied_at": "2025-10-18T14:30:00Z"
}
```

### Delete Resource

```http
DELETE /applications?id=eq.app-789
Authorization: Bearer <JWT>
```

### Call PostgreSQL Function

```http
POST /rpc/semantic_search
Content-Type: application/json
Authorization: Bearer <JWT>

{
  "query_embedding": [0.123, 0.456, ...],
  "similarity_threshold": 0.7,
  "max_results": 20
}
```

## Key Endpoints

### Jobs

```http
# List jobs with filtering
GET /jobs?is_archived=eq.false&match_score=gte.80&tags=overlaps.{typescript,react}

# Get single job
GET /jobs?id=eq.abc-123

# Archive job
PATCH /jobs?id=eq.abc-123
{"is_archived": true, "archived_at": "2025-10-18T12:00:00Z"}

# Semantic search (via function)
POST /rpc/semantic_search
{"query_embedding": [...], "similarity_threshold": 0.7}
```

### Applications

```http
# List applications with embedded job data
GET /applications?select=*,job:jobs(*)&order=updated_at.desc

# Create application
POST /applications
{"job_id": "abc-123", "project_id": "proj-456", "status": "draft"}

# Update application status
PATCH /applications?id=eq.app-789
{"status": "applied", "applied_at": "2025-10-18T14:30:00Z"}
```

### Interviews

```http
# List upcoming interviews
GET /interviews?status=eq.scheduled&scheduled_at=gte.2025-10-18T00:00:00Z&order=scheduled_at.asc

# Create interview
POST /interviews
{
  "application_id": "app-789",
  "scheduled_at": "2025-10-20T14:00:00Z",
  "location": "Zoom: https://zoom.us/j/123456",
  "round": "Technical Round 1"
}

# Update interview outcome
PATCH /interviews?id=eq.int-123
{"status": "completed", "outcome": "passed", "feedback": "Went well..."}
```

## Authentication

**JWT Token Structure**:

```json
{
  "role": "authenticated",
  "user_id": "user-uuid",
  "email": "user@example.com",
  "exp": 1729267200
}
```

**Usage**:

```http
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

JWT tokens are generated by NextAuth.js and validated by PostgREST.

---
